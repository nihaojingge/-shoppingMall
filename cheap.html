<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>大鱼优品</title>
    <meta name="viewport" content=" user-scalable=no">
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/corrected-mall.css" />
    <link rel="stylesheet" href="css/selfsupport.css">
    <link rel="stylesheet" href="css/selfsplit.css">
    <link rel="stylesheet" href="css/selfcut.css">
    <link rel="stylesheet" type="text/css" href="css/swiper.min.clone.css" />
    <style>
        .showy-over-box{
            background:#f3f3f3;
        }
        .showy-over-box-div-cheap{
            width: 33rem;
            border: 0.5rem solid white;
            background: white;
            margin-left:2rem;
             /*padding-bottom: 1rem; */
            padding-bottom: 3rem;
            /*border-bottom: 0.2rem solid #ececec;*/
            display:inline-block;
            /*float:left;*/
            margin-bottom:2rem;
            height:58rem;
            position: relative;
        }
        .showy-over-box-div-p1-span-span{

        }
        .showy-over-box-div-img-cheap{
            width:33rem;
            height:33rem;
            margin:0 auto;
        }
        .cheap-box-div-p3-span2 {
            position: absolute;
            top: -0.5rem;
            right: 2rem;
        }
    </style>
    <!--获取微信权限,引入WX的js-->
    <script src="js/jweixin-1.2.0.js"></script>
    <script src="js/share.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div class="cheap-all">
    <!--标题-->
    <header class="cheap-header">
        <span class="cheap-header-span"></span>
        <img src="picture/ic_h5_003.png" alt="" class="cheap-header-img" onclick="javascript:history.back(-1)">
    </header>
    <div class="cheap-wu">
        <!--分类-->
        <div class="cheap-class">
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!--<div class="swiper-slide"><span class="cheap-class-span cheap-class-span-color">精品</span></div>-->
                    <!--<div class="swiper-slide"><span class="cheap-class-span">搜索</span></div>-->
                    <!--<div class="swiper-slide"><span class="cheap-class-span">精品额度</span></div>-->
                    <!--<div class="swiper-slide"><span class="cheap-class-span">搜索稳定</span></div>-->
                    <!--<div class="swiper-slide"><span class="cheap-class-span">精品我</span></div>-->
                    <!--<div class="swiper-slide"><span class="cheap-class-span">搜索完成伟大伟大伟大</span></div>-->
                </div>
            </div>
        </div>
        <!--banner-->
        <img src="" alt="" class="cheap-img" style="display: none">
        <!--商品展示-->
        <div class="showy-over-box">
            <!--<div class="showy-over-box-div">-->
                <!--<img src="picture/ooooo.png" alt="" class="showy-over-box-div-img1">-->
                <!--<p class="showy-over-box-div-p1">-->
                    <!--<img src="picture/taobao@2x.png" alt="" class="showy-over-box-div-p1-img">-->
                    <!--<span class="showy-over-box-div-p1-span">科技处汪东城汪东城课外读物</span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p2">-->
                    <!--<span class="cheap-box-div-p2-span1">到手价:</span>-->
                    <!--<span class="cheap-box-div-p2-span2 ">￥123</span>-->
                    <!--<span class="cheap-box-div-p2-span3"><s>￥122</s></span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p3">-->
                    <!--<span class="cheap-box-div-p3-span1">评论数123</span>-->
                    <!--<span class="showy-show-div-div-y cheap-box-div-p3-span2">￥3</span>-->
                <!--</p>-->
            <!--</div>-->
            <!--<div class="showy-over-box-div">-->
                <!--<img src="picture/ooooo.png" alt="" class="showy-over-box-div-img1">-->
                <!--<p class="showy-over-box-div-p1">-->
                    <!--<img src="picture/taobao@2x.png" alt="" class="showy-over-box-div-p1-img">-->
                    <!--<span class="showy-over-box-div-p1-span">科技处汪东城汪东城课外读物</span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p2">-->
                    <!--<span class="cheap-box-div-p2-span1">到手价:</span>-->
                    <!--<span class="cheap-box-div-p2-span2 ">￥123</span>-->
                    <!--<span class="cheap-box-div-p2-span3"><s>￥122</s></span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p3">-->
                    <!--<span class="cheap-box-div-p3-span1">评论数123</span>-->
                    <!--<span class="showy-show-div-div-f cheap-box-div-p3-span2">￥3</span>-->
                <!--</p>-->
            <!--</div>-->
            <!--<div class="showy-over-box-div">-->
                <!--<img src="picture/ooooo.png" alt="" class="showy-over-box-div-img1">-->
                <!--<p class="showy-over-box-div-p1">-->
                    <!--<img src="picture/taobao@2x.png" alt="" class="showy-over-box-div-p1-img">-->
                    <!--<span class="showy-over-box-div-p1-span">科技处汪东城汪东城课外读物</span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p2">-->
                    <!--<span class="cheap-box-div-p2-span1">到手价:</span>-->
                    <!--<span class="cheap-box-div-p2-span2 ">￥123</span>-->
                    <!--<span class="cheap-box-div-p2-span3"><s>￥122</s></span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p3">-->
                    <!--<span class="cheap-box-div-p3-span1">评论数123</span>-->
                    <!--<span class="showy-show-div-div-y cheap-box-div-p3-span2">￥3</span>-->
                <!--</p>-->
            <!--</div>-->
            <!--<div class="showy-over-box-div">-->
                <!--<img src="picture/ooooo.png" alt="" class="showy-over-box-div-img1">-->
                <!--<p class="showy-over-box-div-p1">-->
                    <!--<img src="picture/taobao@2x.png" alt="" class="showy-over-box-div-p1-img">-->
                    <!--<span class="showy-over-box-div-p1-span">科技处汪东城汪东城课外读物</span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p2">-->
                    <!--<span class="cheap-box-div-p2-span1">到手价:</span>-->
                    <!--<span class="cheap-box-div-p2-span2 ">￥123</span>-->
                    <!--<span class="cheap-box-div-p2-span3"><s>￥122</s></span>-->
                <!--</p>-->
                <!--<p class="cheap-box-div-p3">-->
                    <!--<span class="cheap-box-div-p3-span1">评论数123</span>-->
                    <!--<span class="showy-show-div-div-f cheap-box-div-p3-span2">￥3</span>-->
                <!--</p>-->
                <!--&lt;!&ndash;后加佣金&ndash;&gt;-->
                <!--<div class="showy-over-box-div-yongjin" style="margin-top:0.8rem;">-->
                    <!--<div class="showy-over-box-div-yongjin-left" style="margin-right:0.5rem;">-->
                        <!--<div class="showy-over-box-div-yongjin-left-txt">佣</div>-->
                        <!--<div class="showy-over-box-div-yongjin-left-txt-money">1000金币</div>-->
                    <!--</div>-->
                    <!--<div class="showy-over-box-div-yongjin-right">-->
                        <!--<img src="picture/wecat@2x.png" alt="">-->
                        <!--<img src="picture/pengyouquan.png" alt="">-->
                        <!--<img src="picture/qq@2x.png" alt="">-->
                        <!--<img src="picture/weibo.png" alt="">-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="donghua" style="width:75rem;height: 10rem;text-align: center;position: relative">
            <div id="targetr" style="display: inline-block;vertical-align: middle;margin-right: 3rem"></div>
            <div  class="wenzi" style="display: inline-block;font-size: 3rem;padding-top: 3rem;margin-left: 3rem;color: #cacaca">正在加载中</div>
        </div>
        <!--返回顶部-->
        <img src="picture/back.png" alt="" class="back">
    </div>

</div>

<script src="js/jquery-1.9.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/selfsupport.js" type="text/javascript" charset="utf-8"></script>
<script src="js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/common.js" type="text/javascript" charset="utf-8" ></script>
<script src="js/commedui.js" type="text/javascript" charset="utf-8" ></script>
<script src="js/allnetapi.js" type="text/javascript" charset="utf-8"></script>
<script src="js/allnetmodel.js" type="text/javascript" charset="utf-8"></script>
 <!--<script src="js/addrefereecode.js" type="text/javascript" charset="utf-8"></script>-->
<script src="js/spin.min.js" type="text/javascript" charset="utf-8"></script>
<script>
    //调用分享获取身份认证
    rank();
    function commonShare(type){
        //调用分享接口
        $.ajax({
            url: "/me/getShare",
            type: "post",
            data:{type:type},
            success: function(result) {
                console.log(result);
                if(result.state==0) {
                    //console.log.log(result.data.title)
                    //调用ready，保证回来的先后数据一致
                    wx.ready(function () {
                        share(result.data.title,result.data.describe,result.data.url,result.data.image);
                    });
                }
            },
            error:function(e){
                //console.log.log(e);
            }
        });
    }
//根据type判断进来的页面是全网好物，还是优惠券页面
    var type = GetQueryString("type");
    if(type==2){
        commonShare("26");
        $(".cheap-header-span").html("全网好物")
    }else {
        commonShare("27");
        $(".cheap-header-span").html("优惠券商品")
    }
    dayu.api.contentNav(type,function (data) {
            console.log("banner商品",data);
            var data = data.data;
            var str=``;
            for(var a=0;a<data.length;a++){
                if(a == 0){
                    str+=`<div class="swiper-slide"><span class="cheap-class-span cheap-class-span-color" data-type="${data[a].type}" data-navId="${data[a].navId}">${data[a].name}</span></div>`
                }else{
                    str+=`<div class="swiper-slide"><span class="cheap-class-span " data-type="${data[a].type}" data-navId="${data[a].navId}">${data[a].name}</span></div>`
                }
            }
            $(".cheap-class .swiper-wrapper").append(str);
            var swiper1 = new Swiper('.swiper-container', {
                slidesPerView: 'auto',
                paginationClickable: true,
                freeMode: true
            });
            $(".cheap-class-span").on("click",function () {
                MtaH5.clickStat("009");
                $(this).addClass("cheap-class-span-color").parent().siblings().find(".cheap-class-span").removeClass("cheap-class-span-color");
                typer = $(this).attr("data-type");
                navId = $(this).attr("data-navId");
                pageId = 1;
                if(typer == 0){
                    isAll = 1;
                    $(".showy-over-box").empty();
                    start();
                }else{
                    isAll = 0;
                    $(".showy-over-box").empty();
                    start();
                }
            })
        },
        function () {
            $(".cheap-class").hide();
        });
    //banner  隐藏
    // console.log(type)banner
    dayu.api.navBanne(type,function (result) {
            console.log(result);
            console.log(result.data);
            if(result.state == 0){
                for(var key in result.data){
                    console.log(result.data[key].content);
                    var type=result.data[key].type;
                    var image=result.data[key].image;
                    var pfrom=result.data[key].content.pfrom;
                    var platformId=result.data[key].content.platformId;
                    var detailUrl=result.data[key].content.detailUrl;
                    var url=result.data[key].content.url;
//                    $(".cheap-img").show().attr("src",image);
                    //  banner点击动作
//                    $(".cheap-img").on("click",function () {
//                        if(type=="product"){
//                            if(pfrom=="淘宝"||pfrom=="天猫"){
//                                location.href="details.html?platformId="+platformId+"&random="+new Date().getTime();
//                            }else{
//                                location.href=detailUrl+"?random="+new Date().getTime();
//                            }
//                        }else{
//                            location.href=url+"?random="+new Date().getTime();
//                        }
//                    })
                }
            }else{
                $(".cheap-img").hide();
            }
        },
        function () {
            $(".cheap-img").hide();
        })
    var typer = 0;
    var navId = 0;
    var pageId = 1;
    var isAll = 1;
    var bool=true;
    var timer;
    var pageTotal;
    function imgs() {
        bool = false;
        dayu.api.navProduct(type,navId,pageId,isAll,function (data) {
                console.log(data);

                if(data.state == 0){
                    var arrs = data.data;
                    var products = new dayu.models.navProduct(arrs);
                    console.log("商品列表",products);
                    if(products.pageTotal>1){
                        Spinner({ color: '#cacaca',length:10,lines:15,radius:17,width:4}).spin(document.getElementById('targetr'));
                    }else{
                        $(".donghua").hide();
                    }
                    var html=``;
                    for (var d=0;d<products.items.length;d++){
                        html+=`
                <div class="showy-over-box-div showy-over-box-div-cheap" data-platformId="${products.items[d].platformId} ">
                <div class="showy-over-box-div-div" data-id="${products.items[d].id} ">
                <img src="picture/${products.items[d].coverimage}" alt="" class="showy-over-box-div-img1 showy-over-box-div-img-cheap" onerror="this.onerror=null; this.src='images/ooooo.png'">
                <p class="showy-over-box-div-p1">
                    <img src="picture/${products.items[d].pfrom}" alt="" class="showy-over-box-div-p1-img">
                    <span class="showy-over-box-div-p1-span showy-over-box-div-p1-span-span">${products.items[d].title}</span>
                </p>`;

                        html+=`<p class="cheap-box-div-p2">`
                        if(products.items[d].price!=undefined){
                            html+=`<span class="cheap-box-div-p2-span1">原价</span>
                    <s class="cheap-box-div-p2-span3">￥${products.items[d].price}</s>`;
                        }else{
                            html+=`<span class="cheap-box-div-p2-span1">&nbsp;</span>
                    <b class="cheap-box-div-p2-span3">&nbsp;</b>`;
                        }

                        html+=` <span class="cheap-box-div-p3-span1">销量 ${products.items[d].sales}</span>

                </p>`;
                        // 1. 优惠券 2. 打折 3. 返利  4. 普通
                        html+=`<p class="cheap-box-div-p2-quanafter-box">`;
                        if(products.items[d].displayType==1){
                            html+=`<span class="cheap-box-div-p2-quanafter-txt">券后</span>
                               <span class="cheap-box-div-p2-quanafter-num">￥${products.items[d].nowPrice}</span>
                               <span class="cheap-box-div-p2-quanafter-img">券 ${products.items[d].displayContent}</span>`;
                        }else if(products.items[d].displayType==3){
                            html+=`<span class="cheap-box-div-p2-quanafter-txt">返后</span>
                               <span class="cheap-box-div-p2-quanafter-num">￥${products.items[d].nowPrice}</span>
                               <span class="cheap-box-div-p2-quanafter-fanimg">返 ${products.items[d].displayContent}</span>`;
                        }else if(products.items[d].displayType==2){
                            html+=`<span class="cheap-box-div-p2-quanafter-txt">折后</span>
                               <span class="cheap-box-div-p2-quanafter-num">￥${products.items[d].nowPrice}</span>
                               <span class="cheap-box-div-p2-zhefter-img">${products.items[d].displayContent}</span>`;
                        }else{
                            html+=`<span class="cheap-box-div-p2-quanafter-txt">现价</span>
                               <span class="cheap-box-div-p2-quanafter-num">￥${products.items[d].nowPrice}</span>`;
                        }
                        html+=`</p>`;

                        html+=`</div>`;
//                佣金
                        if(products.items[d].commission!=undefined){
                            html+=`<div class="showy-over-box-div-yongjin" style="margin-top:1rem;position: absolute;bottom:0.5rem;left:0;">
                    <div class="showy-over-box-div-yongjin-left" style="margin-right:0.5rem;">
                        <div class="showy-over-box-div-yongjin-left-txt">佣金</div>
                        <div class="showy-over-box-div-yongjin-left-txt-money">￥${products.items[d].commission}</div>
                    </div>
                    <div class="showy-over-box-div-yongjin-right">
                        <img src="picture/icon_share _white@2x.png" class="spreader-download-app" alt="">
                        <span>转发</span>
                    </div>
                    </div>`;
                        }

                        html+=`</div>`

                    }
                    $(".showy-over-box").append(html);
                    $(".showy-over-box-div-div").on("click",function () {
                        MtaH5.clickStat("010");
                        window.location="networkProductDetaile.html?id="+$(this).attr("data-id")
                    });
                    //下载APP 佣金
                    downLoadApp($(".showy-over-box-div-yongjin-right"));
                    //	加页
                    pageTotal=products.pageTotal;
                    pageId = products.pageId;
                    if(pageTotal>pageId) {
                         pageId ++;
                    } else {
                        $("#targetr").hide();
                        $(".wenzi").html("已经到底了！！！");
                        setTimeout(function () {
                            $(".donghua").slideUp()
                        },3000)
                        //显示已经到底了
                        // $(".frist-bottom-box-none").show();
                    }
                }else{
                    var h1 = $(".cheap-header").height();
                    var h2 = $(".swiper-wrapper").height();
                    var h3=$(".cheap-img").height();
                    var h4 = $(document).height();
                    var h5 = Number(h4-h3-h2-h1-4)/10;
                    console.log(h1,h2,h3,h4,h5)
                    $(".donghua").hide();
                    $(".showy-over-box").html("<div class='div-none'><img src='picture/xitongchucuo.png' alt='' class='div-none-img'><p class='div-none-p'>抱歉，暂无相关商品  ~   去看看其他活动吧</p><div>").css("background","#fff")
                }

            },
            function (data) {
                clearTimeout(timer);
                timer = setTimeout(function() {
                    bool = true;
                }, 150);
            },
            function () {
                alert("")
            })
    }

    function start() {
        imgs();
        $(window).on('scroll', function() {
            var maxHeight = Math.ceil($(window).scrollTop()+10);
            if(maxHeight >= $(document).height() - $(window).height()) {
                if(bool == true) {
                    if(pageTotal>=pageId){
                        imgs();
                    }
                }
            }
        })
    }
    start();
</script>
<!--腾讯统计-->
<script src="js/count.js"></script>
</body>

</html>