$(function(){var t=GetQueryString("wid"),o=sessionStorage.getItem("userId");$.ajax({type:"post",url:"/me/weibo-detail",async:!0,data:{wid:GetQueryString("wid")},success:function(t){if(0==t.state){0==t.data.isLike?$(".postint-footer-img").attr("src","images/zanh.png"):1==t.data.isLike&&$(".postint-footer-img").attr("src","images/inzan.png");var i="";if(i+="<div class='postint-shows-showpople'>",i+="<div class='postint-shows-showpople-head'>",i+="<div class='postint-shows-showpople-head-a'  uid='"+t.data.uid+"'>",i+=`<img src = '${t.data.icon}' class='postint-shows-showpople-head-img' onerror="this.onerror=null; this.src='../images/w-yuan.jpg'"/>`,i+="<div class='postint-shows-showpople-head-div'>",i+="<p>"+t.data.nickName+"</p>",i+="<p>"+t.data.ctime+"</p>",i+="</div>",i+="</div>",o==t.data.uid?i+="<img src = 'images/shanchu.png' class='postint-shows-showpople-head-img-yichu'/>":0==t.data.isFollow?i+="<img src = 'images/weiguanbai.png' class='postint-shows-showpople-head-img-fox'/>":1==t.data.isFollow&&(i+="<img src = 'images/yiguanhei.png' class='postint-shows-showpople-head-img-fox'/>"),null!=t.data.turnData){if(i+="<p class='postint-shows-showpople-middle' wid='"+t.data.wid+"'>"+dy.icon.replaceText(t.data.content)+"</p>",null!=t.data.turnData.images){i+="<p class='postint-shows-showpople-middle1' wid='"+t.data.turnData.wid+"'><a class='bluecolor' uid='"+t.data.uid+"'>@"+t.data.turnData.nickName+":</a>"+dy.icon.replaceText(t.data.turnData.content)+"<a class='redcolor' tid='"+t.data.tid+"'>#"+t.data.tname+"#</a></p>",i+="<div class='postint-shows-showpople-imgs'  wid='"+t.data.wid+"'>";for(var s=0;s<t.data.turnData.images.length;s++)1==t.data.turnData.images.length?i+=`<img class='postint-shows-showpople-imgs-a' src='${t.data.turnData.images[s]}' onload='loadImg(this)' class='imga'  onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`:2==t.data.turnData.images.length?i+=`<img  src='${t.data.turnData.images[s]}'  onload='loadImgone(this)' class='imga'  onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`:t.data.turnData.images.length>=3&&(i+=`<img  src='${t.data.turnData.images[s]}'  onload='loadImgth(this)' class='imga'  onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`)}else i+="<p class='postint-shows-showpople-middle2' >"+dy.icon.replaceText(t.data.turnData.content)+"<a class='redcolor' tid='"+t.data.tid+"'>#"+t.data.tname+"#</a></p>",i+="<div class='postint-shows-showpople-imgs'  wid='"+t.data.wid+"'>";i+="</div>"}else{i+="<p class='postint-shows-showpople-middle' wid='"+t.data.wid+"'>"+dy.icon.replaceText(t.data.content)+"<a class='redcolor' tid='"+t.data.tid+"'>#"+t.data.tname+"#</a></p>",i+="<div class='postint-shows-showpople-imgs'  wid='"+t.data.wid+"'>";for(var e=0;e<t.data.images.length;e++)1==t.data.images.length?i+=`<img  class='postint-shows-showpople-imgs-a imga'  src='${t.data.images[e]}' onload='loadImg(this)' onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`:2==t.data.images.length?i+=`<img   src='${t.data.images[e]}'  onload='loadImgone(this)' class='imga' onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`:t.data.images.length>=3&&(i+=`<img   src='${t.data.images[e]}'  onload='loadImgth(this)' class='imga' onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`);i+="</div>"}if(null!=t.data.products){i+="<div class='postint-shows-showpople-imgs-bottom'>";for(var n=0;n<t.data.products.length;n++)i+="<div class='postint-shows-showpople-imgs-bottom-int' data-pid='"+t.data.products[n].pid+"'>",i+=`<img src='${t.data.products[n].image}' onerror="this.onerror=null; this.src='../images/ooooo.png'"/>`,i+="<p>"+t.data.products[n].symbol+t.data.products[n].price+"</p>",i+="</div>";i+="</div>"}i+="</div>",i+="</div>",$(".postint-shows").append(i),$(".postint-shows-showpople-imgs-bottom-int").on("click",function(){window.location="s-seckilldetails.html?pid="+$(this).attr("data-pid")+"&random="+(new Date).getTime()}),$(".postint-shows-showpople-middle1").on("click",function(t){var o=(t=t||window.event).target;"redcolor"==$(o).attr("class")?window.location="topic.html?tid="+$(o).attr("tid"):"bluecolor"==$(o).attr("class")?window.location="homepages.html?uid="+$(o).attr("uid"):window.location="postint.html?wid="+$(this).attr("wid")}),$(".postint-shows-showpople-head-img-fox").on("click",function(){var o=t.data.uid,i=$(this);"images/weiguanbai.png"==i.attr("src")?$.ajax({type:"post",url:"/me/follow",async:!0,dataType:"json",data:{uid:o,type:1},success:function(t){if(console.log(t),"none"==t.token){var o=window.location.href;window.sessionStorage.setItem("historyURL",o),window.location="myself.html"}else 0==t.state?i.attr("src","images/yiguanhei.png"):($(".black").text(t.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500))},error:function(t){alert("请求超时")}}):"images/yiguanhei.png"==i.attr("src")&&$.ajax({type:"post",url:"me/follow",async:!0,dataType:"json",data:{uid:o,type:0},success:function(t){if(console.log(t),"none"==t.token){var o=window.location.href;window.sessionStorage.setItem("historyURL",o),window.location="myself.html"}else 0==t.state?i.attr("src","images/weiguanbai.png"):($(".black").text(t.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500))},error:function(t){alert("请求超时")}})}),topic($(".redcolor")),homepages($(".postint-shows-showpople-head-a")),$(".imga").on("click",function(){var t=$(this).parent().index();window.location="image.html?wid="+GetQueryString("wid")+"&index="+t}),$(".postint-shows-showpople-head-img-yichu").on("click",function(){var t=$(document).width(),o=$(document).height();$(".postint-model-del").width(t),$(".postint-model-del").height(o),$(".postint-model-del").show(),$(".postint-dele").show()}),$(".postint-dele-a").on("click",function(){$(".postint-dele").hide(),$(".postint-model-del").hide()}),$(".postint-dele-b").on("click",function(){$(".postint-dele").hide(),$(".postint-model-del").hide(),$.ajax({type:"post",url:"me/weibo-delete",async:!0,data:{wid:GetQueryString("wid")},success:function(t){if(0==t.state){var o=$("<p style='width: 12rem;height: 3rem;background: black;text-align: center;line-height: 3rem;font-size: 1.5rem;color: #FFFFFF;position: fixed;top: 30rem;left: 10rem;border-radius: 0.3rem'>删除成功</p>");$(".postint-all").append(o);var i=document.referrer;setTimeout(function(){o.hide(),window.location=i+"&time="+(new Date).getTime()},1500)}else o=$("<p style='width: 12rem;height: 3rem;background: black;text-align: center;line-height: 3rem;font-size: 1.5rem;color: #FFFFFF;position: fixed;top: 30rem;left: 10rem;border-radius: 0.3rem'>删除失败</p>"),$(".postint-all").append(o),setTimeout(function(){o.hide()},1500)},error:function(t){alert("请求超时")}})})}else $(".postint-a").html($("<div class='div-none'><img src='img/yonghusousuo@2x.png' alt=''><p>该用户已注销</p><div>")),$(".postint-footer").hide()},error:function(t){$(".postint-a").html($("<div class='div-none'><img src='img/yonghusousuo@2x.png' alt=''><p>"+t.stateMsg+"</p><div>")),$(".postint-footer").hide()}});function i(){$.ajax({type:"post",url:"/me/weibo-likes",async:!0,data:{wid:GetQueryString("wid")},success:function(t){if(0==t.state){for($(".postint-middle").show(),$(".postint-middle-p-span").text(t.data.sum+"人点赞"),a=0;a<t.data.items.length;a++){var o="";o+=`<img src='${t.data.items[a].icon}' class='postint-middle-morezan' uid='${t.data.items[a].uid}'  onerror="this.onerror=null; this.src='../images/w-yuan.jpg'"/>`,$(".postint-span-overhiddle").append(o),$(".postint-middle-morezan").on("click",function(){window.location="homepages.html?uid="+$(this).attr("uid")})}t.data.items.length>5&&$(".postint-middle-morezana").show().attr("wid",GetQueryString("wid")),$(".postint-middle-morezana").on("click",function(){window.location="zan.html?wid="+$(this).attr("wid")})}else $(".postint-middle").hide()},error:function(t){}})}i();var s=1,e=!0,n=null;function d(){e=!1,$.ajax({type:"post",url:"/me/weibo-comment",async:!0,data:{wid:GetQueryString("wid"),pageId:s},success:function(t){if(0==t.state){$(".postint-bottom-p1").html(t.data.sum+"条评论");for(var i=0;i<t.data.items.length;i++){var n="";n+="<div class = 'postint-bottom-div' >",n+="<div class='postint-bottom-free' uid='"+t.data.items[i].uid+"'>",n+=`<img src='${t.data.items[i].icon}' class = 'postint-bottom-div-img'  onerror="this.onerror=null; this.src='../images/w-yuan.jpg'">`,n+="<div class='postint-bottom-div-div1' uid='"+t.data.items[i].uid+"'>",n+="<p>"+t.data.items[i].nickName+"</p>",n+="<p>"+t.data.items[i].time+"</p>",n+="</div>",n+="</div>",n+="<div class='postint-conten-o' id='"+t.data.items[i].id+"' uid='"+t.data.items[i].uid+"'>"+dy.icon.replaceText(t.data.items[i].content)+"</div>",n+="<div class='postint-bottom-try' id = '"+t.data.items[i].id+"'>";var a=t.data.items[i];if(null!=a.replies){n+="<div class='postint-conten'>";for(var d=0;d<a.replies.length;d++)n+="<p id='"+a.replies[d].id+"'><span class='bluecolor' uid='"+a.replies[d].uid+"'>"+a.replies[d].uname+":</span>"+dy.icon.replaceText(a.replies[d].content)+"</p>";if(a.sum>a.replies.length)n+="<p class='postint-bottom-p2'>更多"+(a.sum-a.replies.length)+"条回复></p>";n+="</div>"}n+="</div>",n+="<div class='postint-bottom-fox1'>",0==t.data.items[i].isLike?(n+="<img src='images/zanh.png' class='postint-bottom-fox1-inzan' id='"+t.data.items[i].id+"'/>",n+="<span class='community-frist-bot-likes  community-black'>"+t.data.items[i].likes+"</span>"):1==t.data.items[i].isLike&&(n+="<img src='images/inzan.png' class='postint-bottom-fox1-inzan' id='"+t.data.items[i].id+"'/>",n+="<span class='community-frist-bot-likes  community-red'>"+t.data.items[i].likes+"</span>"),n+="</div>",n+="<img src='images/img_zr_11.png'  class='postint-bottom-fox2'  id='"+t.data.items[i].id+"'/>",n+="</div>",$(".postint-bottom-bottom").append(n)}$(".postint-bottom-fox1-inzan").on("click",function(){var t=$(this).attr("id"),o=$(this);$.ajax({type:"post",url:"me/toLike",async:!1,dataType:"json",data:{id:t,type:"2"},success:function(t){if(console.log(t),"none"==t.token){var i=window.location.href;window.sessionStorage.setItem("historyURL",i),window.location="myself.html"}else if(0==t.state){if("images/zanh.png"==o.attr("src")){o.attr("src","images/inzan.png");var s=o.siblings(".community-frist-bot-likes").text();s=++s;o.siblings(".community-frist-bot-likes").text(s).css("color","#FD6363")}else if("images/inzan.png"==o.attr("src")){o.attr("src","images/zanh.png");s=(s=o.siblings(".community-frist-bot-likes").text())-1;o.siblings(".community-frist-bot-likes").text(s).css("color","#999999")}}else $(".black").text(t.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500)},error:function(t){alert("请求超时")}})}),$(".postint-bottom-fox2").on("click",function(){$("#postint-footer-inputa").val("");var t=$(this).attr("id");$(".postion-hight").hide(),$(".postint-footer").hide(),$(".postint-footera").show(),$("#postint-footer-inputa").focus(),$(".postint-footer-spana").attr("id",t)});var r=$(document).width(),l=$(document).height();$(".postint-model").width(r),$(".postint-model").height(l),$(".postint-conten-o").on("click",function(){$(".postint-model").show(),$(".postion-hight").show(),$(".postion-report").hide(),$(window).bind("scroll",function(){document.body.scrollTop=0});var t=$(this).attr("id");$(".postint-footera").hide(),$(".postint-footer").show(),$(this).attr("uid")==o?$(".postion-hight-b").text("删除"):$(".postion-hight-b").text("举报"),$(".postion-hight-a").attr("id",t),$(".postion-hight-b").attr("id",t),$(".postint-footer-spana").removeAttr("id")}),$(".postint-bottom-try").on("click",function(t){var o=(t=t||window.event).target;"bluecolor"==$(o).attr("class")?window.location="homepages.html?uid="+$(o).attr("uid"):window.location="reply.html?id="+$(this).attr("id")}),$(".postint-bottom-free").on("click",function(){window.location="homepages.html?uid="+$(this).attr("uid")}),t.data.pageTotal>s?s=t.data.pageCurr+1:setInterval(function(){e=!1},100)}else $(".postint-bottom-p1").html("0条评论"),$(".postint-bottom-bottom").html($("<div class='div-none' style='margin-bottom: 10rem'><img src='img/tiezipinlun@2x.png' alt=''><p>快点说点啥吧，一楼的心情你不懂~</p><div>"))},complete:function(){clearTimeout(n),n=setTimeout(function(){e=!0},200)},error:function(){}})}d(),$(window).on("scroll",function(){Math.ceil($(window).scrollTop())>=$(document).height()-$(window).height()&&1==e&&d()}),$(".postion-hight-a").on("click",function(){$(".postint-model").hide(),$(window).unbind("scroll"),$(".postion-hight").hide(),$(".postint-footer").hide(),$(".postint-footera").show(),$("#postint-footer-inputa").focus();var t=$(this).attr("id");$(".postint-footer-spana").attr("id",t),$(this).removeAttr("id")}),$(".postint-footer-spana").on("click",function(){var t=$(this).attr("id"),o=$("#postint-footer-inputa").val();0==o.length?($(".black").text("回复不能为空").show(),setTimeout(function(){$(".black").hide()},1500)):o.match(/^\s*$/)?($(".black").text("回复不能为空").show(),setTimeout(function(){$(".black").hide()},1500)):$.ajax({type:"post",url:"me/reply-send",async:!0,dataType:"json",data:{cid:t,content:o},success:function(t){if("none"==t.token){var o=window.location.href;window.sessionStorage.setItem("historyURL",o),window.location="myself.html"}else 0==t.state?($("#postint-footer-inputa").val(""),$(".postint-footer").show(),$(".postint-footera").hide(),$(".postint-bottom-bottom").empty(),s=1,e=!0,n=null,null,d()):($(".black").text(t.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500))},error:function(t){alert("请求超时")}}),$(this).removeAttr("id")}),$(".postion-hight-b").on("click",function(){var t=$(this).attr("id");"删除"==$(this).text()?$.ajax({type:"post",url:"me/comment-delete",async:!0,dataType:"json",data:{cid:t},success:function(t){$(".postint-model").hide(),$(".postion-hight").hide(),$(".postion-report").hide(),$(window).unbind("scroll"),$(".postint-message").html("删除成功").show(),setTimeout(function(){$(".postint-message").hide()},2e3),$(".postint-bottom-bottom").empty(),s=1,e=!0,n=null,null,d()},error:function(t){alert("请求超时")}}):"举报"==$(this).text()&&($(".postint-model").show(),$(".postion-hight").hide(),$(".postion-report").show(),$(".postion-report-a").attr("id",t))}),$(".postion-report-a").on("click",function(){var t=$(this).attr("id"),o=$(this).text();$.ajax({type:"post",url:"me/report",async:!0,dataType:"json",data:{id:t,content:o,type:"2"},success:function(t){if("none"==t.token){var o=window.location.href;window.sessionStorage.setItem("historyURL",o),window.location="myself.html"}else 0==t.state?($(".postint-model").hide(),$(".postion-hight").hide(),$(".postion-report").hide(),$(window).unbind("scroll"),$(".postint-message").html("举报成功").show(),setTimeout(function(){$(".postint-message").hide()},2e3)):($(".postint-message").html(t.stateMsg).show(),setTimeout(function(){$(".postint-message").hide()},2e3))},error:function(t){alert("请求超时")}})}),$(".postion-hight-c").on("click",function(){$(".postint-model").hide(),$(window).unbind("scroll"),$(".postion-hight").hide()}),$("#postint-footer-input").bind("input propertychange",function(){$("#postint-footer-input").val().length>0?($(".postint-footer-span").show(),$(".postint-footer-img").hide(),$(".postint-footer-spans").hide()):($(".postint-footer-span").hide(),$(".postint-footer-img").show(),$(".postint-footer-spans").hide())}),$(".postint-footer-span").on("click",function(){var t=$("#postint-footer-input").val();0==t.length?($(".black").text("评论不能为空").show(),setTimeout(function(){$(".black").hide()},1500)):t.match(/^\s*$/)?($(".black").text("评论不能为空").show(),setTimeout(function(){$(".black").hide()},1500)):$.ajax({type:"post",url:"/me/comment-send",async:!0,dataType:"json",data:{content:t,wid:GetQueryString("wid")},success:function(t){if("none"==t.token){var o=window.location.href;window.sessionStorage.setItem("historyURL",o),window.location="myself.html"}else 0==t.state?($("#postint-footer-input").val(""),$(".postint-footer-span").hide(),$(".postint-footer-img").show(),$(".postint-bottom-bottom").empty(),s=1,e=!0,n=null,null,d()):($(".black").text(t.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500))},error:function(t){alert("请求超时")}})}),$(".postint-footer-img").on("click",function(){var t=$(this),o=GetQueryString("wid");$.ajax({type:"post",url:"/me/toLike",async:!1,dataType:"json",data:{id:o,type:"1"},success:function(o){if("none"==o.token){var s=window.location.href;window.sessionStorage.setItem("historyURL",s),window.location="myself.html"}else 0==o.state?"点赞成功"==o.stateMsg?t.attr("src","images/inzan.png"):t.attr("src","images/zanh.png"):($(".black").text(o.stateMsg).show(),setTimeout(function(){$(".black").hide()},1500));$(".postint-span-overhiddle").empty(),i()},error:function(t){alert("请求超时")}})}),rank(),wx.ready(function(){share("发现一个好的帖子，你也来看看吧","我在大鱼优选社区，发现一个好的帖子，你也来看看吧~",dyyp.DOMAIN+"/postint.html?random="+(new Date).toLocaleTimeString()+"&wid="+t,dyyp.DOMAIN+"/img/new.jpg")})});