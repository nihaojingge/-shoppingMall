function selectFileImage(t){var a=t.files[0],e=null;if(a){console.log("正在上传,请稍后...");if(!/^(image\/jpeg|image\/png)$/i.test(a.type))return;EXIF.getData(a,function(){EXIF.getAllTags(this),e=EXIF.getTag(this,"Orientation")});var i=new FileReader;i.onload=function(t){var a=new Image;a.src=t.target.result,a.onload=function(){var t=this.naturalWidth,a=this.naturalHeight;this.naturalWidth>this.naturalHeight&&this.naturalWidth>800?a=(t=800)*this.naturalHeight/this.naturalWidth:this.naturalHeight>this.naturalWidth&&this.naturalHeight>1200&&(t=(a=1200)*this.naturalWidth/this.naturalHeight);var i=document.createElement("canvas"),h=i.getContext("2d");i.width=t,i.height=a,h.drawImage(this,0,0,t,a);var r=null;if(navigator.userAgent.match(/iphone/i)){if(console.log("iphone"),""!=e&&1!=e)switch(e){case 6:rotateImg(this,"left",i);break;case 8:rotateImg(this,"right",i);break;case 3:rotateImg(this,"right",i),rotateImg(this,"right",i)}r=i.toDataURL("image/jpeg",.8)}else if(navigator.userAgent.match(/Android/i)){r=(new JPEGEncoder).encode(h.getImageData(0,0,t,a),80)}else{if(""!=e&&1!=e)switch(e){case 6:rotateImg(this,"left",i);break;case 8:rotateImg(this,"right",i);break;case 3:rotateImg(this,"right",i),rotateImg(this,"right",i)}r=i.toDataURL("image/jpeg",.8)}$("#myImage").attr("src",r)}},i.readAsDataURL(a)}}function rotateImg(t,a,e){if(null!=t){var i=t.height,h=t.width,r=2;null==r&&(r=0),"right"==a?++r>3&&(r=0):--r<0&&(r=3);var g=90*r*Math.PI/180,n=e.getContext("2d");switch(r){case 0:e.width=h,e.height=i,n.drawImage(t,0,0);break;case 1:e.width=i,e.height=h,n.rotate(g),n.drawImage(t,0,-i);break;case 2:e.width=h,e.height=i,n.rotate(g),n.drawImage(t,-h,-i);break;case 3:e.width=i,e.height=h,n.rotate(g),n.drawImage(t,-h,0)}}}